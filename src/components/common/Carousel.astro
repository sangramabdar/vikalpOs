<div class="relative w-full overflow-hidden p-4 px-8 slideInUp">
  <div
    id="carousel-track"
    class="transition-transform duration-500 ease-in-out flex"
  >
    <slot />
  </div>

  <!-- Navigation -->
  <button
    id="carousel-prev"
    class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-white p-2 shadow rounded-full"
  >
    ‹
  </button>
  <button
    id="carousel-next"
    class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-white p-2 shadow rounded-full"
  >
    ›
  </button>
</div>

<script>
  const track = document.getElementById("carousel-track") as HTMLElement;
  const prevBtn = document.getElementById("carousel-prev") as HTMLButtonElement;
  const nextBtn = document.getElementById("carousel-next") as HTMLButtonElement;

  let index = 0;
  const slides = track.children;
  const total = slides.length;

  const updateButtons = () => {
    const slidesPerView = Math.floor(track.offsetWidth / slides[0].offsetWidth);
    const maxIndex = total - slidesPerView;

    prevBtn.disabled = index === 0;
    nextBtn.disabled = index >= maxIndex;
  };

  const moveSlide = (direction: number) => {
    const offsetWidth = slides[0].offsetWidth;
    const carouselTrackWidth = track.offsetWidth;
    const scrollWidth = slides.length * offsetWidth;

    if (carouselTrackWidth >= scrollWidth || scrollWidth <= offsetWidth) return;

    const slidesPerView = Math.floor(carouselTrackWidth / offsetWidth);
    const maxIndex = total - slidesPerView;

    // Boundary checks
    if (
      (index === 0 && direction < 0) ||
      (index >= maxIndex && direction > 0)
    ) {
      return; // Reached start or end
    }

    index += direction;

    // Clamp to max index
    index = Math.min(index, maxIndex);

    track.style.transform = `translateX(-${index * offsetWidth}px)`;
    updateButtons();
  };

  let direction = "forward";

  setInterval(() => {
    if (index + 1 === total) {
      direction = "backward";
    }

    if (index === 0) {
      direction = "forward";
    }
    if (direction === "forward") {
      moveSlide(1);
    } else {
      moveSlide(-1);
    }
  }, 2000);

  prevBtn.addEventListener("click", () => moveSlide(-1));
  nextBtn.addEventListener("click", () => moveSlide(1));
</script>
